/*
 jQuery Color Animations v2.0pre
 http://jquery.org/

 Copyright 2011 John Resig
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license
*/
(function(f,S){function K(b,t,k){var h=aa[t.type]||{};if((t.empty||k)&&null==b)return null;if(t.def&&null==b)return t.def;b=h.floor?~~b:parseFloat(b);return null==b||isNaN(b)?t.def:h.mod?(b%=h.mod,0>b?h.mod+b:b):h.min>b?h.min:h.max<b?h.max:b}function F(b){var t=l(),k=t._rgba=[];b=b.toLowerCase();P(q,function(h,B){h=(h=B.re.exec(b))&&B.parse(h);var E=B.space||"rgba";B=C[E].cache;if(h)return h=t[E](h),t[B]=h[B],k=t._rgba=h._rgba,!1});if(0!==k.length)return 0===Math.max.apply(Math,k)&&f.extend(k,da.transparent),
t;if(b=da[b])return b}function e(b,t,k){k=(k+1)%1;return 1>6*k?b+6*(t-b)*k:1>2*k?t:2>3*k?b+(t-b)*(2/3-k)*6:b}var c=/^([\-+])=\s*(\d+\.?\d*)/,q=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(b){return[b[1],b[2],b[3],b[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)%\s*,\s*(\d+(?:\.\d+)?)%\s*,\s*(\d+(?:\.\d+)?)%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(b){return[2.55*b[1],2.55*b[2],2.55*b[3],b[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,
parse:function(b){return[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(b){return[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)%\s*,\s*(\d+(?:\.\d+)?)%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(b){return[b[1],b[2]/100,b[3]/100,b[4]]}}],l=f.Color=function(b,t,k,h){return new f.Color.fn.parse(b,t,k,h)},C={rgba:{cache:"_rgba",props:{red:{idx:0,
type:"byte",empty:!0},green:{idx:1,type:"byte",empty:!0},blue:{idx:2,type:"byte",empty:!0},alpha:{idx:3,type:"percent",def:1}}},hsla:{cache:"_hsla",props:{hue:{idx:0,type:"degrees",empty:!0},saturation:{idx:1,type:"percent",empty:!0},lightness:{idx:2,type:"percent",empty:!0}}}},aa={"byte":{floor:!0,min:0,max:255},percent:{min:0,max:1},degrees:{mod:360,floor:!0}},T=C.rgba.props,N=l.support={},P=f.each;C.hsla.props.alpha=T.alpha;l.fn=l.prototype={constructor:l,parse:function(b,t,k,h){if(b===S)return this._rgba=
[null,null,null,null],this;if(b instanceof f||b.nodeType)b=b instanceof f?b.css(t):f(b).css(t),t=S;var B=this,E=f.type(b),I=this._rgba=[];t!==S&&(b=[b,t,k,h],E="array");if("string"===E)return this.parse(F(b)||da._default);if("array"===E)return P(T,function(O,z){I[z.idx]=K(b[z.idx],z)}),this;if("object"===E)return b instanceof l?P(C,function(O,z){b[z.cache]&&(B[z.cache]=b[z.cache].slice())}):P(C,function(O,z){P(z.props,function(G,a){var U=z.cache;if(!B[U]&&z.to){if(null==b[G]||"alpha"===G)return;B[U]=
z.to(B._rgba)}B[U][a.idx]=K(b[G],a,!0)})}),this},is:function(b){var t=l(b),k=!0,h=this;P(C,function(B,E){var I=t[E.cache];if(I){var O=h[E.cache]||E.to&&E.to(h._rgba)||[];P(E.props,function(z,G){if(null!=I[G.idx])return k=I[G.idx]===O[G.idx]})}return k});return k},_space:function(){var b=[],t=this;P(C,function(k,h){t[h.cache]&&b.push(k)});return b.pop()},transition:function(b,t){var k=l(b);b=k._space();var h=C[b],B=this[h.cache]||h.to(this._rgba),E=B.slice();k=k[h.cache];P(h.props,function(I,O){I=
O.idx;var z=B[I],G=k[I],a=aa[O.type]||{};null!==G&&(null===z?E[I]=G:(a.mod&&(G-z>a.mod/2?z+=a.mod:z-G>a.mod/2&&(z-=a.mod)),E[O.idx]=K((G-z)*t+z,O)))});return this[b](E)},blend:function(b){if(1===this._rgba[3])return this;var t=this._rgba.slice(),k=t.pop(),h=l(b)._rgba;return l(f.map(t,function(B,E){return(1-k)*h[E]+k*B}))},toRgbaString:function(){var b="rgba(",t=f.map(this._rgba,function(k,h){return null==k?2<h?1:0:k});1===t[3]&&(t.pop(),b="rgb(");return b+t.join(",")+")"},toHslaString:function(){var b=
"hsla(",t=f.map(this.hsla(),function(k,h){null==k&&(k=2<h?1:0);h&&3>h&&(k=Math.round(100*k)+"%");return k});1===t[3]&&(t.pop(),b="hsl(");return b+t.join(",")+")"},toHexString:function(b){var t=this._rgba.slice(),k=t.pop();b&&t.push(~~(255*k));return"#"+f.map(t,function(h,B){h=(h||0).toString(16);return 1===h.length?"0"+h:h}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}};l.fn.parse.prototype=l.fn;C.hsla.to=function(b){if(null==b[0]||null==b[1]||null==b[2])return[null,
null,null,b[3]];var t=b[0]/255,k=b[1]/255,h=b[2]/255;b=b[3];var B=Math.max(t,k,h),E=Math.min(t,k,h),I=B-E,O=B+E,z=.5*O;return[Math.round(E===B?0:t===B?60*(k-h)/I+360:k===B?60*(h-t)/I+120:60*(t-k)/I+240)%360,0===z||1===z?z:.5>=z?I/O:I/(2-O),z,null==b?1:b]};C.hsla.from=function(b){if(null==b[0]||null==b[1]||null==b[2])return[null,null,null,b[3]];var t=b[0]/360,k=b[1],h=b[2];b=b[3];k=.5>=h?h*(1+k):h+k-h*k;h=2*h-k;return[Math.round(255*e(h,k,t+1/3)),Math.round(255*e(h,k,t)),Math.round(255*e(h,k,t-1/3)),
b]};P(C,function(b,t){var k=t.props,h=t.cache,B=t.to,E=t.from;l.fn[b]=function(I){B&&!this[h]&&(this[h]=B(this._rgba));if(I===S)return this[h].slice();var O=f.type(I),z="array"===O||"object"===O?I:arguments,G=this[h].slice();P(k,function(U,ea){U=z["object"===O?U:ea.idx];null==U&&(U=G[ea.idx]);G[ea.idx]=K(U,ea)});if(E){var a=l(E(G));a[h]=G;return a}return l(G)};P(k,function(I,O){l.fn[I]||(l.fn[I]=function(z){var G=f.type(z),a="alpha"===I?this._hsla?"hsla":"rgba":b,U=this[a](),ea=U[O.idx];if("undefined"===
G)return ea;"function"===G&&(z=z.call(this,ea),G=f.type(z));if(null==z&&O.empty)return this;"string"===G&&(G=c.exec(z))&&(z=ea+parseFloat(G[2])*("+"===G[1]?1:-1));U[O.idx]=z;return this[a](U)})})});P("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color outlineColor".split(" "),function(b,t){f.cssHooks[t]={set:function(k,h){var B;if("string"!==f.type(h)||(B=F(h))){h=l(B||h);if(!N.rgba&&1!==h._rgba[3]){var E="backgroundColor"===t?k.parentNode:k;do B=f.curCSS(E,"backgroundColor");
while((""===B||"transparent"===B)&&(E=E.parentNode)&&E.style);h=h.blend(B&&"transparent"!==B?B:"_default")}h=h.toRgbaString()}k.style[t]=h}};f.fx.step[t]=function(k){k.colorInit||(k.start=l(k.elem,t),k.end=l(k.end),k.colorInit=!0);f.cssHooks[t].set(k.elem,k.start.transition(k.end,k.pos))}});f(function(){var b=document.createElement("div").style;b.cssText="background-color:rgba(1,1,1,.5)";N.rgba=-1<b.backgroundColor.indexOf("rgba")});var da=f.Color.names={aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",
black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",
lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);
(function(f){f.Jcrop=function(S,K){function F(d){return Math.round(d)+"px"}function e(d){d=f(d).offset();return[d.left,d.top]}function c(d){return[d.pageX-oa[0],d.pageY-oa[1]]}function q(d){"object"!==typeof d&&(d={});a=f.extend(a,d);f.each(["onChange","onSelect","onRelease","onDblClick"],function(w,u){"function"!==typeof a[u]&&(a[u]=function(){})})}function l(d,w,u){oa=e(J);ia.setCursor("move"===d?d:d+"-resize");if("move"===d)return ia.activateHandlers(aa(w),b,u);w=L.getFixed();var A=T(d),m=L.getCorner(T(A));
L.setPressed(L.getCorner(A));L.setCurrent(m);ia.activateHandlers(C(d,w),b,u)}function C(d,w){return function(u){if(a.aspectRatio)switch(d){case "e":u[1]=w.y+1;break;case "w":u[1]=w.y+1;break;case "n":u[0]=w.x+1;break;case "s":u[0]=w.x+1}else switch(d){case "e":u[1]=w.y2;break;case "w":u[1]=w.y2;break;case "n":u[0]=w.x2;break;case "s":u[0]=w.x2}L.setCurrent(u);D.update()}}function aa(d){var w=d;za.watchKeys();return function(u){L.moveOffset([u[0]-w[0],u[1]-w[1]]);w=u;D.update()}}function T(d){switch(d){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function N(d){return function(w){if(a.disabled||"move"===d&&!a.allowMove)return!1;oa=e(J);pa=!0;l(d,c(w));w.stopPropagation();w.preventDefault();return!1}}function P(d,w,u){var A=d.width(),m=d.height();A>w&&0<w&&(A=w,m=w/d.width()*d.height());m>u&&0<u&&(m=u,A=u/d.height()*d.width());Y=d.width()/A;ba=d.height()/m;d.width(A).height(m)}function da(d){return{x:d.x*
Y,y:d.y*ba,x2:d.x2*Y,y2:d.y2*ba,w:d.w*Y,h:d.h*ba}}function b(d){d=L.getFixed();d.w>a.minSelect[0]&&d.h>a.minSelect[1]?(D.enableHandles(),D.done()):D.release();ia.setCursor(a.allowSelect?"crosshair":"default")}function t(d){if(a.disabled||!a.allowSelect)return!1;pa=!0;oa=e(J);D.disableHandles();ia.setCursor("crosshair");var w=c(d);L.setPressed(w);D.update();ia.activateHandlers(k,b,"touch"===d.type.substring(0,5));za.watchKeys();d.stopPropagation();d.preventDefault();return!1}function k(d){L.setCurrent(d);
D.update()}function h(){var d=f("<div></div>").addClass(a.baseClass+"-tracker");ea&&d.css({opacity:0,backgroundColor:"white"});return d}function B(d){E([d[0]/Y,d[1]/ba,d[2]/Y,d[3]/ba]);a.onSelect.call(fa,da(L.getFixed()));D.enableHandles()}function E(d){L.setPressed([d[0],d[1]]);L.setCurrent([d[2],d[3]]);D.update()}function I(){a.disabled=!0;D.disableHandles();D.setCursor("default");ia.setCursor("default")}function O(){a.disabled=!1;G()}function z(d,w,u){w=w||a.bgColor;a.bgFade&&f.fx.step.hasOwnProperty("backgroundColor")&&
a.fadeTime&&!u?d.animate({backgroundColor:w},{queue:!1,duration:a.fadeTime}):d.css("backgroundColor",w)}function G(d){a.allowResize?d?D.enableOnly():D.enableHandles():D.disableHandles();ia.setCursor(a.allowSelect?"crosshair":"default");D.setCursor(a.allowMove?"move":"default");a.hasOwnProperty("trueSize")&&(Y=a.trueSize[0]/M,ba=a.trueSize[1]/H);a.hasOwnProperty("setSelect")&&(B(a.setSelect),D.done(),delete a.setSelect);la.refresh();a.bgColor!=Ca&&(z(a.shade?la.getShades():ja,a.shade?a.shadeColor||
a.bgColor:a.bgColor),Ca=a.bgColor);ta!=a.bgOpacity&&(ta=a.bgOpacity,a.shade?la.refresh():D.setBgOpacity(ta));ua=a.maxSize[0]||0;va=a.maxSize[1]||0;wa=a.minSize[0]||0;xa=a.minSize[1]||0;a.hasOwnProperty("outerImage")&&(J.attr("src",a.outerImage),delete a.outerImage);D.refresh()}var a=f.extend({},f.Jcrop.defaults),U=navigator.userAgent.toLowerCase(),ea=/msie/.test(U),Da=/msie [1-6]\./.test(U);"object"!==typeof S&&(S=f(S)[0]);"object"!==typeof K&&(K={});q(K);K={border:"none",visibility:"visible",margin:0,
padding:0,position:"absolute",top:0,left:0};var V=f(S);U=!0;if("IMG"==S.tagName){if(0!=V[0].width&&0!=V[0].height)V.width(V[0].width),V.height(V[0].height);else{var Aa=new Image;Aa.src=V[0].src;V.width(Aa.width);V.height(Aa.height)}var J=V.clone().removeAttr("id").css(K).show();J.width(V.width());J.height(V.height());V.after(J).hide()}else J=V.css(K).show(),U=!1,null===a.shade&&(a.shade=!0);P(J,a.boxWidth,a.boxHeight);var M=J.width(),H=J.height(),ja=f("<div />").width(M).height(H).addClass(a.baseClass+
"-holder").css({position:"relative",backgroundColor:a.bgColor}).insertAfter(V).append(J);a.addClass&&ja.addClass(a.addClass);var ma=f("<div />"),ya=f("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),qa=f("<div />").width("100%").height("100%").css("zIndex",320),ra=f("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var d=L.getFixed();a.onDblClick.call(fa,d)}).insertBefore(J).append(ya,qa);U&&(ma=f("<img />").attr("src",J.attr("src")).css(K).width(M).height(H),
ya.append(ma));Da&&ra.css({overflowY:"hidden"});var sa=a.boundary,na=h().width(M+2*sa).height(H+2*sa).css({position:"absolute",top:F(-sa),left:F(-sa),zIndex:290}).mousedown(t),Ca=a.bgColor,ta=a.bgOpacity,ua,va,wa,xa,Y,ba,pa,Ba,Ea;var oa=e(J);var ha=function(){function d(){var u={},A=["touchstart","touchmove","touchend"],m=document.createElement("div"),p;try{for(p=0;p<A.length;p++){var y=A[p];y="on"+y;var v=y in m;v||(m.setAttribute(y,"return;"),v="function"==typeof m[y]);u[A[p]]=v}return u.touchstart&&
u.touchend&&u.touchmove}catch(Z){return!1}}var w=!0===a.touchSupport||!1===a.touchSupport?a.touchSupport:d();return{createDragger:function(u){return function(A){if(a.disabled||"move"===u&&!a.allowMove)return!1;oa=e(J);pa=!0;l(u,c(ha.cfilter(A)),!0);A.stopPropagation();A.preventDefault();return!1}},newSelection:function(u){return t(ha.cfilter(u))},cfilter:function(u){u.pageX=u.originalEvent.changedTouches[0].pageX;u.pageY=u.originalEvent.changedTouches[0].pageY;return u},isSupported:d,support:w}}(),
L=function(){function d(){if(!a.aspectRatio){var g=y-m,x=v-p;ua&&Math.abs(g)>ua&&(y=0<g?m+ua:m-ua);va&&Math.abs(x)>va&&(v=0<x?p+va:p-va);xa/ba&&Math.abs(x)<xa/ba&&(v=0<x?p+xa/ba:p-xa/ba);wa/Y&&Math.abs(g)<wa/Y&&(y=0<g?m+wa/Y:m-wa/Y);0>m&&(y-=m,m-=m);0>p&&(v-=p,p-=p);0>y&&(m-=y,y-=y);0>v&&(p-=v,v-=v);y>M&&(g=y-M,m-=g,y-=g);v>H&&(g=v-H,p-=g,v-=g);m>M&&(g=m-H,v-=g,p-=g);p>H&&(g=p-H,v-=g,p-=g);return A(u(m,p,y,v))}g=a.aspectRatio;x=a.minSize[0]/Y;var R=a.maxSize[0]/Y,Q=y-m,ca=v-p,r=Math.abs(Q),n=Math.abs(ca);
0===R&&(R=10*M);r/n<g?(r=v,n*=g,n=0>Q?m-n:n+m,0>n?(n=0,r=Math.abs((n-m)/g),r=0>ca?p-r:r+p):n>M&&(n=M,r=Math.abs((n-m)/g),r=0>ca?p-r:r+p)):(n=y,r/=g,r=0>ca?p-r:p+r,0>r?(r=0,n=Math.abs((r-p)*g),n=0>Q?m-n:n+m):r>H&&(r=H,n=Math.abs(r-p)*g,n=0>Q?m-n:n+m));n>m?(n-m<x?n=m+x:n-m>R&&(n=m+R),r=r>p?p+(n-m)/g:p-(n-m)/g):n<m&&(m-n<x?n=m-x:m-n>R&&(n=m-R),r=r>p?p+(m-n)/g:p-(m-n)/g);0>n?(m-=n,n=0):n>M&&(m-=n-M,n=M);0>r?(p-=r,r=0):r>H&&(p-=r-H,r=H);return A(u(m,p,n,r))}function w(g){0>g[0]&&(g[0]=0);0>g[1]&&(g[1]=
0);g[0]>M&&(g[0]=M);g[1]>H&&(g[1]=H);return[Math.round(g[0]),Math.round(g[1])]}function u(g,x,R,Q){var ca=g,r=R,n=x,W=Q;R<g&&(ca=R,r=g);Q<x&&(n=Q,W=x);return[ca,n,r,W]}function A(g){return{x:g[0],y:g[1],x2:g[2],y2:g[3],w:g[2]-g[0],h:g[3]-g[1]}}var m=0,p=0,y=0,v=0,Z,X;return{flipCoords:u,setPressed:function(g){g=w(g);y=m=g[0];v=p=g[1]},setCurrent:function(g){g=w(g);Z=g[0]-y;X=g[1]-v;y=g[0];v=g[1]},getOffset:function(){return[Z,X]},moveOffset:function(g){var x=g[0];g=g[1];0>m+x&&(x-=x+m);0>p+g&&(g-=
g+p);H<v+g&&(g+=H-(v+g));M<y+x&&(x+=M-(y+x));m+=x;y+=x;p+=g;v+=g},getCorner:function(g){var x=d();switch(g){case "ne":return[x.x2,x.y];case "nw":return[x.x,x.y];case "se":return[x.x2,x.y2];case "sw":return[x.x,x.y2]}},getFixed:d}}(),la=function(){function d(){return w(L.getFixed())}function w(x){g.top.css({left:F(x.x),width:F(x.w),height:F(x.y)});g.bottom.css({top:F(x.y2),left:F(x.x),width:F(x.w),height:F(H-x.y2)});g.right.css({left:F(x.x2),width:F(M-x.x2)});g.left.css({width:F(x.x)})}function u(){return f("<div />").css({position:"absolute",
backgroundColor:a.shadeColor||a.bgColor}).appendTo(X)}function A(){Z||(Z=!0,X.insertBefore(J),d(),D.setBgOpacity(1,0,1),ma.hide(),m(a.shadeColor||a.bgColor,1),D.isAwake()?y(a.bgOpacity,1):y(1,1))}function m(x,R){z(v(),x,R)}function p(){Z&&(X.remove(),ma.show(),Z=!1,D.isAwake()?D.setBgOpacity(a.bgOpacity,1,1):(D.setBgOpacity(1,1,1),D.disableHandles()),z(ja,0,1))}function y(x,R){Z&&(a.bgFade&&!R?X.animate({opacity:1-x},{queue:!1,duration:a.fadeTime}):X.css({opacity:1-x}))}function v(){return X.children()}
var Z=!1,X=f("<div />").css({position:"absolute",zIndex:240,opacity:0}),g={top:u(),left:u().height(H),right:u().height(H),bottom:u()};return{update:d,updateRaw:w,getShades:v,setBgColor:m,enable:A,disable:p,resize:function(x,R){g.left.css({height:F(R)});g.right.css({height:F(R)})},refresh:function(){a.shade?A():p();D.isAwake()&&y(a.bgOpacity)},opacity:y}}(),D=function(){function d(r,n){n=f("<div />").mousedown(N(r)).css({cursor:r+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+r);ha.support&&
n.bind("touchstart.jcrop",ha.createDragger(r));qa.append(n);return n}function w(r){var n;for(n=0;n<r.length;n++)d(r[n],R++).addClass("jcrop-dragbar")}function u(r){var n;for(n=0;n<r.length;n++){switch(r[n]){case "n":var W="hline";break;case "s":W="hline bottom";break;case "e":W="vline right";break;case "w":W="vline"}var ka=W;ka=f("<div />").css({position:"absolute",opacity:a.borderOpacity}).addClass(a.baseClass+"-"+ka);ya.append(ka)}}function A(r){var n;for(n=0;n<r.length;n++){var W=a.handleSize,
ka=d(r[n],R++).css({opacity:a.handleOpacity}).addClass(a.baseClass+"-handle");W&&ka.width(W).height(W)}}function m(){var r=L.getFixed();L.setPressed([r.x,r.y]);L.setCurrent([r.x2,r.y2]);p()}function p(r){if(x)return y(r)}function y(r){var n=L.getFixed(),W=n.h;ra.width(Math.round(n.w)).height(Math.round(W));W=n.x;var ka=n.y;a.shade||ma.css({top:F(-ka),left:F(-W)});ra.css({top:F(ka),left:F(W)});a.shade&&la.updateRaw(n);x||(ra.show(),a.shade?la.opacity(ta):v(ta,!0),x=!0);r?a.onSelect.call(fa,da(n)):
a.onChange.call(fa,da(n))}function v(r,n,W){if(x||n)a.bgFade&&!W?J.animate({opacity:r},{queue:!1,duration:a.fadeTime}):J.css("opacity",r)}function Z(){Q=!0;if(a.allowResize)return qa.show(),!0}function X(){Q=!1;qa.hide()}function g(r){r?(Ba=!0,X()):(Ba=!1,Z())}var x,R=370,Q=!1;a.dragEdges&&f.isArray(a.createDragbars)&&w(a.createDragbars);f.isArray(a.createHandles)&&A(a.createHandles);a.drawBorders&&f.isArray(a.createBorders)&&u(a.createBorders);f(document).bind("touchstart.jcrop-ios",function(r){f(r.currentTarget).hasClass("jcrop-tracker")&&
r.stopPropagation()});var ca=h().mousedown(N("move")).css({cursor:"move",position:"absolute",zIndex:360});ha.support&&ca.bind("touchstart.jcrop",ha.createDragger("move"));ya.append(ca);X();return{updateVisible:p,update:y,release:function(){X();ra.hide();a.shade?la.opacity(1):v(1);x=!1;a.onRelease.call(fa)},refresh:m,isAwake:function(){return x},setCursor:function(r){ca.css("cursor",r)},enableHandles:Z,enableOnly:function(){Q=!0},showHandles:function(){Q&&qa.show()},disableHandles:X,animMode:g,setBgOpacity:v,
done:function(){g(!1);m()}}}(),ia=function(){function d(v){m(c(v));return!1}function w(v){v.preventDefault();v.stopPropagation();pa&&(pa=!1,p(c(v)),D.isAwake()&&a.onSelect.call(fa,da(L.getFixed())),na.css({zIndex:290}),f(document).unbind(".jcrop"),m=function(){},p=function(){});return!1}function u(v){m(c(ha.cfilter(v)));return!1}function A(v){return w(ha.cfilter(v))}var m=function(){},p=function(){},y=a.trackDocument;y||na.mousemove(d).mouseup(w).mouseout(w);J.before(na);return{activateHandlers:function(v,
Z,X){pa=!0;m=v;p=Z;na.css({zIndex:450});X?f(document).bind("touchmove.jcrop",u).bind("touchend.jcrop",A):y&&f(document).bind("mousemove.jcrop",d).bind("mouseup.jcrop",w);return!1},setCursor:function(v){na.css("cursor",v)}}}(),za=function(){function d(p){A.hide()}function w(p,y,v){a.allowMove&&(L.moveOffset([y,v]),D.updateVisible(!0));p.preventDefault();p.stopPropagation()}function u(p){if(p.ctrlKey||p.metaKey)return!0;var y=(Ea=p.shiftKey?!0:!1)?10:1;switch(p.keyCode){case 37:w(p,-y,0);break;case 39:w(p,
y,0);break;case 38:w(p,0,-y);break;case 40:w(p,0,y);break;case 27:a.allowSelect&&D.release();break;case 9:return!0}return!1}var A=f('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),m=f("<div />").css({position:"absolute",overflow:"hidden"}).append(A);a.keySupport&&(A.keydown(u).blur(d),Da||!a.fixedSupport?(A.css({position:"absolute",left:"-20px"}),m.append(A).insertBefore(J)):A.insertBefore(J));return{watchKeys:function(){a.keySupport&&(A.show(),
A.focus())}}}();ha.support&&na.bind("touchstart.jcrop",ha.newSelection);qa.hide();G(!0);var fa={setImage:function(d,w){D.release();I();var u=new Image;u.onload=function(){var A=u.height,m=a.boxWidth,p=a.boxHeight;J.width(u.width).height(A);J.attr("src",d);ma.attr("src",d);P(J,m,p);M=J.width();H=J.height();ma.width(M).height(H);na.width(M+2*sa).height(H+2*sa);ja.width(M).height(H);la.resize(M,H);O();"function"===typeof w&&w.call(fa)};u.src=d},animateTo:function(d,w){var u=d[0]/Y,A=d[1]/ba,m=d[2]/Y,
p=d[3]/ba;if(!Ba){d=L.flipCoords(u,A,m,p);var y=L.getFixed(),v=[y.x,y.y,y.x2,y.y2],Z=a.animationDelay,X=d[0]-v[0],g=d[1]-v[1],x=d[2]-v[2],R=d[3]-v[3],Q=0,ca=a.swingSpeed;u=v[0];A=v[1];m=v[2];p=v[3];D.animMode(!0);var r=function(){return function(){Q+=(100-Q)/ca;v[0]=Math.round(u+Q/100*X);v[1]=Math.round(A+Q/100*g);v[2]=Math.round(m+Q/100*x);v[3]=Math.round(p+Q/100*R);99.8<=Q&&(Q=100);100>Q?(E(v),window.setTimeout(r,Z)):(D.done(),D.animMode(!1),"function"===typeof w&&w.call(fa))}}();window.setTimeout(r,
Z)}},setSelect:B,setOptions:function(d){q(d);G()},tellSelect:function(){return da(L.getFixed())},tellScaled:function(){return L.getFixed()},setClass:function(d){ja.removeClass().addClass(a.baseClass+"-holder").addClass(d)},disable:I,enable:O,cancel:function(){D.done();ia.activateHandlers(null,null)},release:D.release,destroy:function(){ja.remove();V.show();V.css("visibility","visible");f(S).removeData("Jcrop")},focus:za.watchKeys,getBounds:function(){return[M*Y,H*ba]},getWidgetSize:function(){return[M,
H]},getScaleFactor:function(){return[Y,ba]},getOptions:function(){return a},ui:{holder:ja,selection:ra}};ea&&ja.bind("selectstart",function(){return!1});V.data("Jcrop",fa);return fa};f.fn.Jcrop=function(S,K){var F;this.each(function(){if(f(this).data("Jcrop")){if("api"===S)return f(this).data("Jcrop");f(this).data("Jcrop").setOptions(S)}else"IMG"==this.tagName?f.Jcrop.Loader(this,function(){f(this).css({display:"block",visibility:"hidden"});F=f.Jcrop(this,S);f.isFunction(K)&&K.call(F)}):(f(this).css({display:"block",
visibility:"hidden"}),F=f.Jcrop(this,S),f.isFunction(K)&&K.call(F))});return this};f.Jcrop.Loader=function(S,K,F){function e(){q.complete?(c.unbind(".jcloader"),f.isFunction(K)&&K.call(q)):window.setTimeout(e,50)}var c=f(S),q=c[0];c.bind("load.jcloader",e).bind("error.jcloader",function(l){c.unbind(".jcloader");f.isFunction(F)&&F.call(q)});q.complete&&f.isFunction(K)&&(c.unbind(".jcloader"),K.call(q))};f.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",
addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},
onRelease:function(){}}})(jQuery);
(function(f,S){var K=0;const F="png PNG jpg JPG jpeg JPEG".split(" ");f.widget("s3.imageUpload",{options:{},_create:function(){this.id=K;K+=1;this.eventNamespace=".imageUpload"},_init:function(){var e=f(this.element);const c=e.attr("id");e=e.closest("div.image-upload");this.canvas=f(".image-upload-canvas",e);this.canvasSize=[0,0];this.toScale=!0;this.uploadTitle=f(".upload-title",e);this.uploadContainer=f(".upload-container",e);this.uploadedImage=f(".uploaded-image",e);this.dropArea=f(".imagecrop-drag",
e);this.captureButton=f(".capture-btn",e);this.videoDialog=null;this.imageData=f("input#"+c+"-imagecrop-data",e);this.selectCrop=f(".select-crop-btn",e);this.crop=f(".crop-btn",e);this.cancel=f(".remove-btn",e);this.cropPoints=this.jCropAPI=this.extension=this.fileName=this.image=null;this.refresh()},_destroy:function(){this._removeCropAPI();this._removeVideoDialog()},refresh:function(){this._unbindEvents();this.image=new Image;this.fileName="upload.png";this.extension="png";this._removeCropAPI();
this._removeVideoDialog();f(this.element).closest("div.image-upload");const e=this.canvas,c=this;if(e.length){var q=e.width(),l=e.height();this.toScale=!0;if(0==q||0==l)this.toScale=!1,q=l=600;this.canvasSize=[q,l];var C=this.image,aa=this.imageData,T=aa.data("url");T&&(C.src=T,C.onload=function(){e.attr({width:C.width,height:C.height});e[0].getContext("2d").drawImage(C,0,0,C.width,C.height);var N=T.split(".");N=N[N.length-1];"jpg"==N&&(N="jpeg");c.extension=N;let P=aa.data("filename");c.fileName=
P?P:"upload_"+(new Date).valueOf()+"."+N;N=e[0].toDataURL("image/"+N,.99);c._loadImage(N)});this._bindEvents()}},_calculateScale:function(e,c){let q;c[0]>e[0]&&(q=e[0]/c[0],c[0]*=q,c[1]*=q);c[1]>e[1]&&(q=e[1]/c[1],c[0]*=q,c[1]*=q);c[0]=Math.floor(c[0]);c[1]=Math.floor(c[1]);return c},_loadImage:function(e){const c=this,q=this.image;q.src=e;q.onload=function(){var l=c._calculateScale(c.canvasSize,[q.width,q.height]);let C=c.canvas[0];C.width=l[0];C.height=l[1];C.getContext("2d").drawImage(q,0,0,l[0],
l[1]);l=C.toDataURL("image/"+c.extension,.99);c.toScale?c.imageData.val(c.fileName+";"+l):c.imageData.val(c.fileName+";"+e);c.uploadedImage.attr({src:l,style:"display: block"});c.selectCrop.css({display:"inline"}).siblings("hr").show()}},_initCropAPI:function(){const e=this;this._removeCropAPI();this.uploadedImage.Jcrop({onChange:function(c){e.cropPoints=[c.x,c.y,c.x2,c.y2]},opacity:.2,bgFade:!0,bgColor:"black",addClass:"jcrop-light"},function(){e.jCropAPI=this;this.ui.selection.addClass("jcrop-selection");
this.disable()})},_removeCropAPI:function(){const e=this.jCropAPI;e&&(e.destroy(),this.jCropAPI=null);this.cropPoints=null},_activateCrop:function(){const e=this.jCropAPI;if(e){e.enable();var c=e.getBounds(),q=c[0]/7,l=c[1]/7;e.animateTo([q,l,c[0]-q,c[1]-l]);this.selectCrop.css({display:"none"});this.crop.css({display:"inline"});this.cancel.css({display:"inline"})}},_deactivateCrop:function(){const e=this.jCropAPI;e&&(e.release(),e.disable());this.selectCrop.css({display:"inline"});this.crop.css({display:"none"});
this.cancel.css({display:"none"})},_cropImage:function(){var e=this.image,c=f(".jcrop-holder",f(this.element).closest("div.image-upload")),q=parseInt(c.css("width").split("px")[0]),l=parseInt(c.css("height").split("px")[0]);c=e.width/q;l=e.height/l;if(q=this.cropPoints){var C=q[0],aa=q[1],T=q[3];q=Math.round((q[2]-C)*c);l=Math.round((T-aa)*l);this._deactivateCrop();this._removeCropAPI();T=this.canvas;var N=T[0];T.attr({width:q,height:l});N.getContext("2d").drawImage(e,Math.round(C*c),Math.round(aa*
c),q,l,0,0,q,l);e=N.toDataURL("image/"+this.extension,.99);this._loadImage(e)}},_isValidImage:function(e){e=e.type.split("/");var c=e[e.length-1];if("image"==e[0]&&-1!=f.inArray(c,F))return"png"==c||"PNG"==c?"png":"jpeg"},_indicateFileOver:function(e){e.stopPropagation();e.preventDefault();let c=f(e.target);"dragenter"==e.type?c.addClass("hover"):c.removeClass("hover")},_loadSelectedFile:function(e){const c=f(this.element),q=this;this._removeCropAPI();this._indicateFileOver(e);this._hideUpload(!0);
e=(e.target.files||e.originalEvent.dataTransfer.files)[0];var l=this._isValidImage(e);l?(this.fileName=e.name,this.extension=l,l=new FileReader,l.onload=function(C){q._loadImage(C.target.result)},l.readAsDataURL(e)):alert(i18n.invalid_image+"\n"+i18n.supported_image_formats+": png, jpeg or jpg");c.val("")},_openVideoDialog:function(){const e=this,c=this.eventNamespace;var q=f('<div class="capture-form">'),l=f('<video class="preview-video">').appendTo(q),C=f('<button type="button">'+i18n.capture_image_ok+
"</button>");C.addClass("primary button action-btn shutter-btn").appendTo(q);this.videoForm=q;var aa=this.captureButton.hide(),T=f('<div class="inline-throbber">').insertAfter(aa);q.dialog({title:i18n.capture_image_from_video,width:800,autoOpen:!1,modal:!0,classes:{"ui-dialog":"capture-dialog"},close:function(){}});navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:1280}},audio:!1}).then(N=>{T.remove();aa.show();l.show();q.dialog("open");
let P=l.get(0);P.srcObject=N;P.play();l.add(C).off(c).on("click"+c,function(da){da.stopPropagation();da.preventDefault();e._captureImage(P,N);e._removeVideoDialog()})}).catch(N=>{alert(`An error occurred: ${N}`);T.remove();e.captureButton.prop("disabled",!0).hide();e._removeVideoDialog()})},_captureImage:function(e,c){const q=this;var l=!1;if("ImageCapture"in window)try{const aa=c.getVideoTracks()[0];(new ImageCapture(aa)).takePhoto().then(function(T){C=URL.createObjectURL(T);q._hideUpload(!0);C&&
(q.fileName="capture_"+(new Date).valueOf()+".png",q.extension="png",q._loadImage(C))});l=True}catch(aa){}if(!l){c=document.createElement("canvas");c.width=e.videoWidth;c.height=e.videoHeight;c.getContext("2d").drawImage(e,0,0,c.width,c.height);var C=c.toDataURL("image/png",.99);c.remove();q._hideUpload(!0);C&&(q.fileName="capture_"+(new Date).valueOf()+".png",q.extension="png",q._loadImage(C))}},_removeVideoDialog:function(){var e=this.videoForm;e&&(e.dialog("close").dialog("destroy").remove(),this.videoForm=
null)},_hideUpload:function(e){const c=this;var q=e?i18n.upload_new_image:i18n.upload_image;setTimeout(function(){c.uploadContainer.slideUp("fast",function(){c.uploadTitle.html("<a>"+q+"</a>")})},500)},_bindEvents:function(){let e=f(this.element),c=this.eventNamespace,q=this;e.on("change"+c,function(l){q._loadSelectedFile(l)});this.uploadTitle.on("click"+c,function(l){q.uploadContainer.slideDown("fast",function(){q.uploadTitle.html(i18n.upload_image)})});this.selectCrop.on("click"+c,function(){q._activateCrop()});
this.crop.on("click"+c,function(){q._cropImage()});this.cancel.on("click"+c,function(){q._deactivateCrop()});this.uploadedImage.on("load"+c,function(){q._initCropAPI()});this.dropArea.on("dragenter"+c,function(l){l.stopPropagation();l.preventDefault();q._indicateFileOver(l)}).on("dragover"+c,function(l){l.stopPropagation();l.preventDefault()}).on("dragleave"+c,function(l){q._indicateFileOver(l)}).on("drop"+c,function(l){l.stopPropagation();l.preventDefault();q._loadSelectedFile(l)});this.captureButton.on("click"+
c,function(){q._openVideoDialog()});return this},_unbindEvents:function(){let e=f(this.element),c=this.eventNamespace;e.off(c);this.uploadTitle.off(c);this.selectCrop.off(c);this.crop.off(c);this.cancel.off(c);this.uploadedImage.off(c);this.dropArea.off(c);this.captureButton.off(c);return this}})})(jQuery);$(function(){});
