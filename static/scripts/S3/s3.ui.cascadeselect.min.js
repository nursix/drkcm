/*
 2019 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery UI MultiSelect Widget 1.14 by Eric Hynds
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(c){var d=0;return function(){return d<c.length?{done:!1,value:c[d++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,d,f){if(c==Array.prototype||c==Object.prototype)return c;c[d]=f.value;return c};$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,c,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var d=0;d<c.length;++d){var f=c[d];if(f&&f.Math==Math)return f}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(c,d){var f=$jscomp.propertyToPolyfillSymbol[d];if(null==f)return c[d];f=c[f];return void 0!==f?f:c[d]};
$jscomp.polyfill=function(c,d,f,a){d&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(c,d,f,a):$jscomp.polyfillUnisolated(c,d,f,a))};$jscomp.polyfillUnisolated=function(c,d,f,a){f=$jscomp.global;c=c.split(".");for(a=0;a<c.length-1;a++){var b=c[a];if(!(b in f))return;f=f[b]}c=c[c.length-1];a=f[c];d=d(a);d!=a&&null!=d&&$jscomp.defineProperty(f,c,{configurable:!0,writable:!0,value:d})};
$jscomp.polyfillIsolated=function(c,d,f,a){var b=c.split(".");c=1===b.length;a=b[0];a=!c&&a in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var e=0;e<b.length-1;e++){var g=b[e];if(!(g in a))return;a=a[g]}b=b[b.length-1];f=$jscomp.IS_SYMBOL_NATIVE&&"es6"===f?a[b]:null;d=d(f);null!=d&&(c?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:d}):d!==f&&(void 0===$jscomp.propertyToPolyfillSymbol[b]&&(f=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(b):$jscomp.POLYFILL_PREFIX+f+"$"+b),$jscomp.defineProperty(a,$jscomp.propertyToPolyfillSymbol[b],{configurable:!0,writable:!0,value:d})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(c){if(c)return c;var d=function(e,g){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};d.prototype.toString=function(){return this.$jscomp$symbol$id_};var f="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",a=0,b=function(e){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new d(f+(e||"")+"_"+a++,e)};return b},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(c){if(c)return c;c=Symbol("Symbol.iterator");for(var d="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),f=0;f<d.length;f++){var a=$jscomp.global[d[f]];"function"===typeof a&&"function"!=typeof a.prototype[c]&&$jscomp.defineProperty(a.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return c},"es6",
"es3");$jscomp.iteratorPrototype=function(c){c={next:c};c[Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,d){c instanceof String&&(c+="");var f=0,a=!1,b={next:function(){if(!a&&f<c.length){var e=f++;return{value:d(e,c[e]),done:!1}}a=!0;return{done:!0,value:void 0}}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(d){return d})}},"es6","es3");
(function(c,d){var f=0;c.widget("s3.cascadeSelect",{options:{multiple:!0,leafonly:!0,cascade:!0},_create:function(){this.id=f;f+=1;this.eventNamespace=".cascadeSelect"},_init:function(){var a=c(this.element);this.hiddenInput=c(".s3-cascade-input",a).first();this.refresh()},_destroy:function(){c.Widget.prototype.destroy.call(this)},refresh:function(){var a=c(this.element);this._unbindEvents();var b=[];c("select.s3-cascade-select",a).each(function(){b.push(c(this).empty().data("available",{}))});b.sort(function(g,
l){return g.data("level")-l.data("level")});this.selectors=b;a=this._getHierarchy();for(var e in a)this._addAvailableOption(null,0,e,a[e]);this._renderOptions(b[0],Object.keys(a),[]);e=this._deserialize();this._updateOptions(b[b.length-1],e);this._multiSelectInit();this._bindEvents()},get:function(){return this._deserialize()},set:function(a){this.reset();if(a){a.constructor!==Array&&(a=[a]);a=a.map(function(e){return""+e});var b=this.selectors;this._updateOptions(b[b.length-1],a);this._serialize();
return this}},reset:function(){this.selectors.forEach(function(a,b){a.val("");0<b&&c("option",a).remove();(a=a.multiselect("instance"))&&a.refresh()});this._serialize();this._toggleSelectors();return this},_deserialize:function(){var a=JSON.parse(this.hiddenInput.val());return a?a.map(function(b){return""+b}):[]},_serialize:function(){for(var a=this.options,b=[],e=this.selectors,g=e.length;g--;){var l=e[g],k=l.prop("multiple"),h=l.data("available");l=this._getSelected(l);for(var m=0,q=l.length;m<
q;m++){var n=l[m],p=h[n];if(!(!p||a.leafonly&&p[3])&&(-1==b.indexOf(n)&&b.push(n),b.length&&!k))break}if(b.length&&!k)break}this.hiddenInput.val(JSON.stringify(b)).trigger("select.s3hierarchy")},_multiSelectInit:function(){this.selectors.forEach(function(a){a.multiselect("instance")?a.multiselect("refresh"):a.prop("multiple")&&a.multiselect({})})},_getHierarchy:function(){var a=c(this).element,b=this.hierarchy;b===d&&(a=c(".s3-cascade",a),this.hierarchy=b=JSON.parse(a.val()));return b},_updateOptions:function(a,
b,e){var g=a.data("level"),l=a.data("available"),k=[];b=b.slice(0);this._getSelected(a).forEach(function(m){-1!=b.indexOf(m)||e&&-1==e.indexOf(m)||b.push(m)});if(0===g)this._setSelected(a,b);else if(e)this._renderOptions(a,e,b);else{var h=b.slice(0);b.forEach(function(m){m=l[m];m!==d&&-1==h.indexOf(m[0])&&h.push(m[0])});this._updateOptions(this.selectors[g-1],h)}if(0===g||e)a=this.selectors[g+1],a!==d?(b.forEach(function(m){m=l[m];m!==d&&(k=k.concat(Object.keys(m[3])))}),this._updateOptions(a,b,k)):
this._toggleSelectors()},_renderOptions:function(a,b,e){var g=this.options;!g.multiple&&g.cascade&&1==b.length&&(g=b[0],-1==e.indexOf(g)&&e.push(g));var l=a.data("available");a.empty();var k=[];b.forEach(function(h){var m=l[h];m&&k.push([h,m[1]])});k.sort(function(h,m){return h[1].localeCompare(m[1])});k.forEach(function(h){c("<option>").val(h[0]).text(h[1]).appendTo(a)});this._setSelected(a,e)},_getSelected:function(a){return(a=c(a).val())?a.constructor===Array?a.map(function(b){return""+b}):[""+
a]:[]},_setSelected:function(a,b){var e=a.data("available"),g=a.multiselect("instance");b=b.filter(function(l){return e[""+l]!==d});a.prop("multiple")?a.val(b):a.val(b[0]);g&&g.refresh()},_addAvailableOption:function(a,b,e,g){var l=this.selectors[b];if(l){var k=l.data("available");if(k===d||null===k)k={};k[""+e]=[""+a].concat(g);l.data("available",k);if((a=g[2])&&!0!==a)for(var h in a)this._addAvailableOption(e,b+1,h,a[h])}},_toggleSelectors:function(){this.selectors.forEach(function(a){var b=a.multiselect("instance");
c("option",a).length?(a.prop("disabled",!1),b&&b.enable()):(a.prop("disabled",!0),b&&b.disable())})},_hiddenBranches:function(a,b){var e=[],g=a.data("level");if(g=this.selectors[g+1]){var l=a.data("available"),k={};b.forEach(function(h){if((h=l[h])&&(h=h[3])&&!0!==h)for(var m in h)k[""+m]=!0});c("option",g).each(function(){k[c(this).val()]=!1});e=Object.keys(k).filter(function(h){return k[h]});e=e.concat(this._hiddenBranches(g,e))}return e},_bindEvents:function(){var a=c(this.element),b=this.eventNamespace,
e=this.options,g=this;c("select.s3-cascade-select",a).on("change"+b,function(){var l=c(this),k=g._getSelected(l);e.multiple&&e.cascade&&g._hiddenBranches(l,k).forEach(function(h){-1==k.indexOf(h)&&k.push(h)});g._updateOptions(l,k);g._serialize()});return!0},_unbindEvents:function(){var a=c(this.element),b=this.eventNamespace;c("select.s3-cascade-select",a).off(b);return!0}})})(jQuery);
